<!DOCTYPE html>
<html>
<head>
    <title>Shopping Cart</title>
    <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self';
    connect-src 'self' https://*.doap.com https://nh4za4vqt3.execute-api.us-west-2.amazonaws.com;
    style-src 'self';
    img-src 'self' data:;
    font-src 'self';">

</head>
<body>
    <h1>Shopping Cart</h1>
    <form id="cartForm">
        <label>
            <input type="checkbox" name="item" value="Item1|10"> Item 1 - $10
        </label><br>
        <label>
            <input type="checkbox" name="item" value="Item2|15"> Item 2 - $15
        </label><br>
        <label>
            <input type="checkbox" name="item" value="Item3|20"> Item 3 - $20
        </label><br><br>

        <label for="address">Address:</label><br>
        <textarea id="address" name="address" required></textarea><br><br>

        <label for="total">Total Price:</label>
        <span id="total">$0</span><br><br>

        <button id="checkoutButton">Checkout</button>
    </form>

    <script>
document.getElementById("checkoutButton").addEventListener("click", submitCart);

const cartForm = document.getElementById('cartForm');
const totalDisplay = document.getElementById('total');

cartForm.addEventListener('change', () => {
    const itemElements = cartForm.querySelectorAll('input[name="item"]'); // Select all items by name
    if (!itemElements) {
        console.error('No items found in the cart.');
        totalDisplay.textContent = '$0';
        return;
    }
        cartForm.addEventListener('change', () => {
            const itemElements = cartForm.querySelectorAll('input[name="item"]'); // Select all items by name
            const items = Array.from(itemElements)
                .filter(el => el.checked) // Filter checked items
                .map(el => parseFloat(el.value.split('|')[1])); // Extract the price
            const total = items.reduce((sum, price) => sum + price, 0);
            totalDisplay.textContent = `$${total}`;
        });

        async function submitCart() {
            const itemElements = cartForm.querySelectorAll('input[name="item"]'); // Select all items by name
            const items = Array.from(itemElements)
                .filter(el => el.checked) // Filter checked items
                .map(el => el.value.split('|')[0]); // Extract the name
            const address = document.getElementById('address').value;
            const total = totalDisplay.textContent;

    const items = Array.from(itemElements)
        .filter(el => el.checked) // Filter checked items
        .map(el => parseFloat(el.value.split('|')[1])); // Extract the price

    const total = items.reduce((sum, price) => sum + price, 0);
    totalDisplay.textContent = `$${total}`;
});

async function submitCart() {
    try {
        const itemElements = cartForm.querySelectorAll('input[name="item"]');
        if (!itemElements) {
            throw new Error('No items found in the cart.');
        }

        const items = Array.from(itemElements)
            .filter(el => el.checked) // Filter checked items
            .map(el => el.value.split('|')[0]); // Extract the name

        if (items.length === 0) {
            throw new Error('No items selected.');
        }

        const address = document.getElementById('address').value;
        if (!address) {
            throw new Error('Address is required.');
        }

        const total = totalDisplay.textContent;

        const data = { items, address, total };

        const response = await fetch(
            'https://nh4za4vqt3.execute-api.us-west-2.amazonaws.com/prod/checkout',
            {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data),
            }
        );

        if (response.ok) {
            alert('Order submitted successfully!');
        } else {
            const errorText = await response.text();
            console.error('Error submitting order:', errorText);
            alert('Error submitting order.');
        }
    } catch (error) {
        console.error('Error:', error.message);
        alert(error.message);
    }
}
    </script>
</body>
</html>

